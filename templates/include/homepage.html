{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>{% block title %} {{ settings.title }} {% endblock %}</title>

    <!-- Csrf token -->
    <meta name="csrf-token" content="IPm4NiTYMph5awdcGN7IM4yPrDb1caiBnLM6mYLe">

    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static '/favicon.svg' %}" type="image/x-icon">

    <!-- Fonts -->
    <link rel="stylesheet" href="{% static './css/fonts.css' %}"/>
    <link rel="stylesheet" href="{% static './fonts/fontawesome/fontawesome.css' %}"/>

    <!-- Styles -->
    <link rel="stylesheet" href="{% static './css/bootstrap.min.css' %}"/>
    <link rel="stylesheet" href="{% static './css/normalize.css' %}"/>
    <link rel="stylesheet" href="{% static './css/loader.css' %}">
    <link rel="stylesheet" href="{% static './plugins/sweetalert2/sweetalert2.css' %}">
    <link rel="stylesheet" href="{% static './css/style.css' %}"/>
    <link rel="stylesheet" href="{% static './css/swiper-bundle.min.css' %}"/>

    <style>
        .card.card-package  {
            background: #FFF8EF;
            border-radius: 6px
        }
    </style>
    <link rel="stylesheet" href="{% static './css/media.css' %}"/>
</head>
<body class="wrap d-flex flex-column min-vh-100">
    {% include 'include/navbar.html' %}
    {% block content %}
    {% endblock %}
    {% include 'include/footer.html' %}
    <script src="{% static '/js/jquery.min.js' %}"></script>
<script src="{% static '/js/mask.input.js' %}"></script>
<script src="{% static '/plugins/sweetalert2/sweetalert2.js' %}"></script>
<script src="{% static '/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static '/js/script.js' %}"></script>

    <script src="{% static '/js/swiper-bundle.min.js' %}"></script>
    <script>
        let swiper = new Swiper(".mySwiper", {
            pagination: {
                el: ".swiper-pagination",
                clickable: true,
            },
            // autoplay: {
            //     delay: 5000,
            //     disableOnInteraction: false,
            // },
        });
    
        let swiperSecond = new Swiper(".mySwiper-second", {
            slidesPerView: 3,
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            breakpoints: {
                320: {
                    slidesPerView: 1,
                },
                640: {
                    slidesPerView: 1,
                },
                768: {
                    slidesPerView: 2,
                },
                1024: {
                    slidesPerView: 3,
                },
            },
        });
        

        function openSpeakerSendCommentModal(speakerId, courseId) {
            $("#speaker-id").val(speakerId);
            $("#course-id").val(courseId);
            $('#speakerSendCommentModal').modal('show');
        }
    </script>
    <script>
        $('#navbarSupportedContent').on('show.bs.collapse', function () {
            $('body').css('overflow-y', 'hidden')
        })
    
        $('#navbarSupportedContent').on('hide.bs.collapse', function () {
            $('body').css('overflow-y', 'auto')
        })
    
        function activeTab(activeTab = 'login') {
            if (activeTab === 'login') {
                $('#tab02').removeClass('active')
                $('#tab021').removeClass('show')
                $('#tab01').addClass('active')
                $('#tab011').addClass('show')
            } else {
                $('#tab01').removeClass('active')
                $('#tab011').removeClass('show')
                $('#tab02').addClass('active')
                $('#tab021').addClass('show')
            }
        }
    
        function openLogin() {
            activeTab('login')
            $('#myModal').modal('show')
        }
    
        function openRegister() {
            activeTab('register')
            $('#myModal').modal('show')
        }
    
        function alertModal(text = "", timer = 1500) {
            Swal.fire({
                text: text ? text : "Сәтті аяқталды!",
                padding: '2em',
                icon: 'success',
                showConfirmButton: false,
                timer: timer
            })
        }
    
        function alertWarningModal(text = "") {
            Swal.fire({
                text: text ? `${text}` : "Қате!",
                padding: '2em',
                icon: 'warning',
                showConfirmButton: true,
            })
        }
    </script>
    <script>
        function payCourse(course_id) {
            $(".loader").addClass("loading");
            let _token = $('meta[name="csrf-token"]').attr('content');
            $.ajax({
                url: 'https://daiyndal.kz/courses/course/16/pay',
                method: 'post',
                statusCode: {
                    401: function () {
                        $('.modal').modal('hide')
                        $('#loginForm').modal('show')
                    }
                },
                data: {
                    course_id: course_id,
                    _token: _token,
                },
                success: function (res) {
                    $(".loader").removeClass("loading");
                    if (res.data.url) {
                        window.open(res.data.url, '_top');
                    }
                },
                error: function (err) {
                    $(".loader").removeClass("loading");
                    let response_text = JSON.parse(err.responseText);
                }
            })
        }

        $('.accordion').accordion({
            multiOpen: true,
            duration: 300
        });

        function openSpeakerSendCommentModal(speakerId, courseId) {
            $("#speaker-id").val(speakerId);
            $("#course-id").val(courseId);
            $('#speakerSendCommentModal').modal('show');
        }

        $(function () {
            $('#speakerSendCommentForm').submit(function (e) {
                e.preventDefault();

                let comment = $(this).find("#comment").val();
                let speakerId = parseInt($(this).find('#speaker-id').val());
                let courseId = parseInt($(this).find('#course-id').val());
                let rate = $(this).find('[name="rate"]:checked').val();

                let _token = $('meta[name="csrf-token"]').attr('content');
                $(".loader").addClass("loading");

                clearInvalidFeedback()

                $.ajax({
                    url: $(this).attr('action'),
                    type: "POST",
                    method: "POST",
                    data: {
                        'comment': comment,
                        'speaker_id': speakerId,
                        'course_id': courseId,
                        'rate': rate,
                        '_token': _token
                    },
                    success: function (res) {
                        $(".loader").removeClass("loading");
                        if (res && res.success) {
                            alertModal('Отправлено успешно!');
                            setTimeout(() => {
                                window.location.reload()
                            }, 1500)
                        } else {
                            alertWarningModal(res.error);
                        }
                    },
                    error: function (err) {
                        $(".loader").removeClass("loading");
                        let response_text = JSON.parse(err.responseText);
                        if (response_text.errors && typeof response_text.errors == 'object') {
                            Object.entries(response_text.errors).forEach(([key, value]) => {
                                $('#error-send-' + key).text(value[0]);
                                $('#error-send-' + key).css('display', 'block');
                                $('#send-' + key).addClass('is-invalid');
                            })
                        }
                    }
                });
            });
        })
    </script>

</body>
</html>
